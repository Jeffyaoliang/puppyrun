# 微信小程序域名要求说明

## ✅ 重要说明

**所有推荐的方案都可以最终部署到微信小程序！**

无论是使用：
- ✅ Cloudflare Tunnel + 正式域名
- ✅ ngrok 付费版 + 固定域名
- ✅ 云服务器 + 域名 + SSL
- ✅ Vercel + 自定义域名

只要满足微信小程序的要求，都可以正常使用。

---

## 📋 微信小程序域名要求

### 1. 必须使用 HTTPS

- ✅ 支持 HTTPS
- ❌ 不支持 HTTP

### 2. 域名必须在微信后台配置

#### 开发环境

在微信开发者工具中：
- ✅ 可以勾选「不校验合法域名」
- ✅ 可以访问任何 HTTPS 地址（包括 ngrok、Cloudflare Tunnel 等）
- ✅ 方便开发测试

#### 真机测试 / 正式发布

必须在微信小程序后台配置合法域名：

1. **登录微信公众平台**
   - 访问：https://mp.weixin.qq.com/
   - 使用小程序账号登录

2. **配置服务器域名**
   - 路径：开发 -> 开发管理 -> 开发设置 -> 服务器域名
   - 在「request合法域名」中添加你的 API 域名
   - 只填写域名，不需要 `https://`
   - 例如：`api.yourdomain.com`

3. **其他域名配置**
   - **uploadFile合法域名**：用于上传文件（如照片上传）
   - **downloadFile合法域名**：用于下载文件
   - **socket合法域名**：用于 WebSocket 连接

### 3. 域名要求

#### ✅ 被认可的域名

- `.com` - 最被认可
- `.cn` - 国内认可度高（需要备案）
- `.net` - 传统域名
- `.org` - 组织域名
- `.xyz` - 通常可以（推荐）
- `.top` - 通常可以
- `.site` - 通常可以
- `.online` - 通常可以

#### ⚠️ 可能不被认可的域名

- `.tk, .ml, .ga` - 免费域名，可能不被认可
- 某些小众后缀

#### 域名来源

- ✅ 从正规平台购买的域名（阿里云、腾讯云、Namecheap 等）
- ✅ 已备案的域名（如果服务器在国内）
- ✅ Cloudflare Tunnel 绑定的域名
- ✅ ngrok 付费版的固定域名
- ❌ 内网穿透的临时地址（免费版，地址会变化）

---

## 🚀 完整部署流程

### 方案 1：Cloudflare Tunnel + 正式域名（推荐）

#### 步骤 1：购买域名

1. 在阿里云或腾讯云购买域名（推荐 `.xyz`，约 10-20元/年）
2. 完成实名认证

#### 步骤 2：配置 Cloudflare Tunnel

1. 将域名添加到 Cloudflare
2. 安装并配置 Cloudflare Tunnel
3. 获得固定域名：`https://api.yourdomain.com`

#### 步骤 3：配置微信小程序

1. **在小程序中配置**
   ```typescript
   // miniprogram/utils/config.ts
   export const API_BASE_URL = 'https://api.yourdomain.com';
   ```

2. **在微信后台配置合法域名**
   - 登录：https://mp.weixin.qq.com/
   - 开发 -> 开发管理 -> 开发设置
   - 添加 `api.yourdomain.com` 到「request合法域名」

#### 步骤 4：测试和发布

1. 在开发者工具中测试
2. 真机预览测试
3. 提交审核
4. 发布上线

**✅ 完全支持微信小程序！**

---

### 方案 2：云服务器 + 域名 + SSL

#### 步骤 1：购买云服务器和域名

1. 购买云服务器（如 Paratera）
2. 购买域名（.xyz 或 .com）

#### 步骤 2：部署后端

1. 在服务器上部署后端代码
2. 配置 Nginx 反向代理
3. 配置 SSL 证书（Let's Encrypt 免费）

#### 步骤 3：配置微信小程序

1. 在小程序中配置域名
2. 在微信后台添加合法域名

**✅ 完全支持微信小程序！**

---

### 方案 3：Vercel + 自定义域名

#### 步骤 1：部署到 Vercel

1. 上传代码到 GitHub
2. 导入到 Vercel
3. 获得地址：`https://your-project.vercel.app`

#### 步骤 2：配置自定义域名

1. 购买域名
2. 在 Vercel 中添加自定义域名
3. 配置 DNS 解析

#### 步骤 3：配置微信小程序

1. 在小程序中配置域名
2. 在微信后台添加合法域名

**✅ 完全支持微信小程序！**

---

## ⚠️ 注意事项

### 1. 域名备案

**国内服务器：**
- 域名必须备案
- 备案需要 1-2 周
- 备案期间可以使用临时方案（内网穿透）开发

**国外服务器：**
- 不需要备案
- 可以直接使用
- **推荐：** 如果不想备案，使用国外服务器

### 2. SSL 证书

- ✅ Let's Encrypt（免费）
- ✅ Cloudflare Tunnel（自动 HTTPS）
- ✅ Vercel（自动 HTTPS）
- ✅ ngrok（自动 HTTPS）

### 3. 开发 vs 生产

**开发阶段：**
- 可以使用内网穿透（ngrok 免费版）
- 在开发者工具中关闭域名校验
- 快速开发测试

**生产环境：**
- 必须购买正式域名
- 必须在微信后台配置合法域名
- 推荐使用固定域名方案

---

## 📝 推荐方案对比

| 方案 | 成本 | 域名稳定性 | 微信小程序支持 | 推荐度 |
|------|------|-----------|---------------|--------|
| **Cloudflare Tunnel + .xyz** | 10-20元/年 | ⭐⭐⭐⭐⭐ 固定 | ✅ 完全支持 | ⭐⭐⭐⭐⭐ |
| **云服务器 + 域名 + SSL** | 域名 + 服务器 | ⭐⭐⭐⭐⭐ 固定 | ✅ 完全支持 | ⭐⭐⭐⭐ |
| **Vercel + 自定义域名** | 域名费用 | ⭐⭐⭐⭐⭐ 固定 | ✅ 完全支持 | ⭐⭐⭐⭐ |
| **ngrok 付费版** | $8/月 | ⭐⭐⭐⭐⭐ 固定 | ✅ 完全支持 | ⭐⭐⭐ |
| **ngrok 免费版** | 免费 | ⭐ 会变化 | ⚠️ 仅开发环境 | ⭐⭐ |

---

## ✅ 最终确认

### 可以部署到微信小程序的方案

1. ✅ **Cloudflare Tunnel + 正式域名**（推荐）
   - 购买 `.xyz` 域名（10-20元/年）
   - 配置 Cloudflare Tunnel
   - 在微信后台添加合法域名
   - **完全支持！**

2. ✅ **云服务器 + 域名 + SSL**
   - 购买域名和服务器
   - 部署后端
   - 配置 SSL
   - 在微信后台添加合法域名
   - **完全支持！**

3. ✅ **Vercel + 自定义域名**
   - 部署到 Vercel
   - 配置自定义域名
   - 在微信后台添加合法域名
   - **完全支持！**

### 仅开发环境使用的方案

- ⚠️ ngrok 免费版（地址会变化）
- ⚠️ 内网穿透临时地址

---

## 🎯 推荐流程

### 阶段 1：开发阶段

1. 使用 ngrok 免费版快速开始
2. 在开发者工具中关闭域名校验
3. 专注于功能开发

### 阶段 2：测试阶段

1. 购买 `.xyz` 域名（10-20元/年）
2. 配置 Cloudflare Tunnel
3. 获得固定域名
4. 在微信后台添加合法域名
5. 真机测试

### 阶段 3：生产环境

1. 继续使用 Cloudflare Tunnel（完全够用）
2. 或升级到云服务器（如果需要更多控制）
3. 提交审核并发布

---

## 📚 完整文档

相关文档：
- [Cloudflare Tunnel详细指南.md](./Cloudflare Tunnel详细指南.md)
- [域名购买推荐.md](./域名购买推荐.md)
- [快速配置后端API.md](./快速配置后端API.md)

---

## 🆘 常见问题

### Q1: 免费域名可以用吗？

**A:** 
- `.tk, .ml, .ga` 等免费域名可能不被微信认可
- 建议购买正式域名（.xyz 约 10-20元/年）

### Q2: 必须备案吗？

**A:**
- 国内服务器：必须备案
- 国外服务器：不需要备案
- **推荐：** 使用国外服务器，无需备案

### Q3: Cloudflare Tunnel 可以用吗？

**A:** ✅ **完全可以！**
- 绑定正式域名后
- 在微信后台添加合法域名
- 完全支持微信小程序

### Q4: 开发时可以用临时地址吗？

**A:** ✅ **可以！**
- 开发环境：可以使用 ngrok 免费版
- 真机测试：必须使用正式域名
- 生产环境：必须使用正式域名

---

## 💡 最终建议

**最佳方案：**

1. **开发阶段：** 使用 ngrok 免费版快速开发
2. **测试阶段：** 购买 `.xyz` 域名 + Cloudflare Tunnel
3. **生产环境：** 继续使用 Cloudflare Tunnel（或升级到云服务器）

**成本：**
- 域名：10-20元/年
- Cloudflare Tunnel：免费
- **总计：10-20元/年** ✅

**结果：**
- ✅ 固定域名
- ✅ 全球 CDN
- ✅ 自动 HTTPS
- ✅ **完全支持微信小程序！**

现在就按照这个方案开始配置吧！

