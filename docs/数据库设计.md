# 奶狗快跑 - 数据库设计文档

## 1. 用户相关表

### 1.1 users - 用户基础信息表
```sql
CREATE TABLE `users` (
  `uid` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `openid` VARCHAR(64) NOT NULL COMMENT '微信OpenID',
  `unionid` VARCHAR(64) DEFAULT NULL COMMENT '微信UnionID',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT '手机号（加密存储）',
  `nickname` VARCHAR(50) DEFAULT NULL COMMENT '昵称',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT '头像URL',
  `role` ENUM('male_student', 'female') NOT NULL COMMENT '用户角色',
  `auth_status` ENUM('pending', 'verified', 'rejected') DEFAULT 'pending' COMMENT '认证状态',
  `age_bucket` VARCHAR(10) DEFAULT NULL COMMENT '年龄段（如18-25, 28-38）',
  `city` VARCHAR(50) DEFAULT NULL COMMENT '所在城市',
  `risk_level` TINYINT DEFAULT 0 COMMENT '风险等级（0-正常，1-低风险，2-高风险）',
  `member_level` ENUM('normal', 'silver', 'gold') DEFAULT 'normal' COMMENT '会员等级',
  `member_expires_at` DATETIME DEFAULT NULL COMMENT '会员到期时间',
  `status` ENUM('active', 'blocked', 'deleted') DEFAULT 'active' COMMENT '账号状态',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `deleted_at` DATETIME DEFAULT NULL COMMENT '软删除时间',
  PRIMARY KEY (`uid`),
  UNIQUE KEY `uk_openid` (`openid`),
  KEY `idx_phone` (`phone`),
  KEY `idx_city_age` (`city`, `age_bucket`),
  KEY `idx_auth_status` (`auth_status`),
  KEY `idx_member_level` (`member_level`, `member_expires_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户基础信息表';
```

### 1.2 user_identity - 用户身份认证表
```sql
CREATE TABLE `user_identity` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `doc_type` ENUM('student_card', 'id_card') NOT NULL COMMENT '证件类型',
  `doc_hash_enc` VARCHAR(128) NOT NULL COMMENT '证件哈希（加密）',
  `doc_image_url` VARCHAR(255) DEFAULT NULL COMMENT '证件图片URL（加密存储）',
  `face_image_url` VARCHAR(255) DEFAULT NULL COMMENT '人脸照片URL',
  `liveness_score` DECIMAL(5,2) DEFAULT NULL COMMENT '活体检测分数',
  `ocr_result` JSON DEFAULT NULL COMMENT 'OCR识别结果（加密）',
  `asset_proof_url` VARCHAR(255) DEFAULT NULL COMMENT '资产证明URL（女生可选，加密）',
  `asset_flag` TINYINT DEFAULT 0 COMMENT '是否有资产证明',
  `verified_at` DATETIME DEFAULT NULL COMMENT '认证通过时间',
  `reject_reason` VARCHAR(255) DEFAULT NULL COMMENT '拒绝原因',
  `status` ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_uid` (`uid`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户身份认证表';
```

## 2. 问卷与画像表

### 2.1 questionnaire - 问卷数据表
```sql
CREATE TABLE `questionnaire` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `basic_info` JSON NOT NULL COMMENT '基础信息（年龄、学历、职业、城市、作息）',
  `interests` JSON NOT NULL COMMENT '兴趣偏好（列表）',
  `social_needs` JSON NOT NULL COMMENT '社交需求（列表）',
  `values` JSON NOT NULL COMMENT '价值观倾向（消费观、边界、沟通方式）',
  `appearance_pref` JSON DEFAULT NULL COMMENT '外貌偏好',
  `interests_vec` BLOB DEFAULT NULL COMMENT '兴趣向量（128维）',
  `needs_vec` BLOB DEFAULT NULL COMMENT '需求向量（64维）',
  `values_vec` BLOB DEFAULT NULL COMMENT '价值观向量（64维）',
  `profile_tags` JSON DEFAULT NULL COMMENT '用户标签（计算得出）',
  `completed_at` DATETIME DEFAULT NULL COMMENT '完成时间',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_uid` (`uid`),
  KEY `idx_completed` (`completed_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='问卷数据表';
```

### 2.2 photos - 用户照片表
```sql
CREATE TABLE `photos` (
  `photo_id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `url` VARCHAR(255) NOT NULL COMMENT '照片URL',
  `is_primary` TINYINT DEFAULT 0 COMMENT '是否为主照片',
  `quality_score` DECIMAL(3,1) DEFAULT NULL COMMENT '质量评分（1-10）',
  `ai_style_score` DECIMAL(3,1) DEFAULT NULL COMMENT 'AI风格评分',
  `ai_taste_score` DECIMAL(3,1) DEFAULT NULL COMMENT 'AI气质评分',
  `ai_coordination_score` DECIMAL(3,1) DEFAULT NULL COMMENT 'AI整体协调度',
  `audit_status` ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT '审核状态',
  `sort_order` INT DEFAULT 0 COMMENT '排序',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`photo_id`),
  KEY `idx_uid` (`uid`, `is_primary`),
  KEY `idx_audit` (`audit_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户照片表';
```

### 2.3 match_index - 匹配索引表（用于向量检索）
```sql
CREATE TABLE `match_index` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `feature_vec` BLOB NOT NULL COMMENT '特征向量（256维，用于ANN检索）',
  `city` VARCHAR(50) DEFAULT NULL COMMENT '城市',
  `age_bucket` VARCHAR(10) DEFAULT NULL COMMENT '年龄段',
  `is_student` TINYINT DEFAULT 0 COMMENT '是否学生',
  `asset_flag` TINYINT DEFAULT 0 COMMENT '是否有资产证明',
  `last_active_at` DATETIME DEFAULT NULL COMMENT '最后活跃时间',
  `match_priority` INT DEFAULT 0 COMMENT '匹配优先级',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_uid` (`uid`),
  KEY `idx_city_age` (`city`, `age_bucket`),
  KEY `idx_active` (`last_active_at`),
  KEY `idx_priority` (`match_priority`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='匹配索引表';
```

## 3. 匹配相关表

### 3.1 likes - 喜欢/不感兴趣记录表
```sql
CREATE TABLE `likes` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `target_uid` BIGINT UNSIGNED NOT NULL COMMENT '目标用户ID',
  `action` ENUM('like', 'pass') NOT NULL COMMENT '操作类型',
  `reason` VARCHAR(255) DEFAULT NULL COMMENT '不感兴趣原因（pass时）',
  `match_score` INT DEFAULT NULL COMMENT '匹配分数',
  `status` ENUM('pending', 'mutual', 'blocked') DEFAULT 'pending' COMMENT '状态',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_uid_target` (`uid`, `target_uid`),
  KEY `idx_target` (`target_uid`, `status`),
  KEY `idx_mutual` (`status`, `created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='喜欢记录表';
```

### 3.2 matches - 匹配成功表
```sql
CREATE TABLE `matches` (
  `match_id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid_a` BIGINT UNSIGNED NOT NULL COMMENT '用户A ID',
  `uid_b` BIGINT UNSIGNED NOT NULL COMMENT '用户B ID',
  `match_score` INT NOT NULL COMMENT '匹配分数',
  `match_reasons` JSON DEFAULT NULL COMMENT '匹配原因',
  `status` ENUM('active', 'blocked', 'ended') DEFAULT 'active' COMMENT '匹配状态',
  `contact_unlocked` TINYINT DEFAULT 0 COMMENT '是否已解锁联系方式',
  `unlocked_at` DATETIME DEFAULT NULL COMMENT '解锁时间',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`match_id`),
  UNIQUE KEY `uk_users` (`uid_a`, `uid_b`),
  KEY `idx_uid_a` (`uid_a`, `status`),
  KEY `idx_uid_b` (`uid_b`, `status`),
  KEY `idx_created` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='匹配成功表';
```

## 4. 聊天相关表

### 4.1 messages - 聊天消息表
```sql
CREATE TABLE `messages` (
  `msg_id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `match_id` BIGINT UNSIGNED NOT NULL COMMENT '匹配ID',
  `sender_uid` BIGINT UNSIGNED NOT NULL COMMENT '发送者ID',
  `receiver_uid` BIGINT UNSIGNED NOT NULL COMMENT '接收者ID',
  `content` TEXT NOT NULL COMMENT '消息内容（加密）',
  `content_type` ENUM('text', 'image') DEFAULT 'text' COMMENT '消息类型',
  `image_url` VARCHAR(255) DEFAULT NULL COMMENT '图片URL',
  `audit_status` ENUM('pending', 'passed', 'blocked') DEFAULT 'pending' COMMENT '审核状态',
  `audit_reason` VARCHAR(255) DEFAULT NULL COMMENT '审核原因',
  `is_read` TINYINT DEFAULT 0 COMMENT '是否已读',
  `read_at` DATETIME DEFAULT NULL COMMENT '已读时间',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`msg_id`),
  KEY `idx_match` (`match_id`, `created_at`),
  KEY `idx_sender` (`sender_uid`, `created_at`),
  KEY `idx_receiver` (`receiver_uid`, `is_read`),
  KEY `idx_audit` (`audit_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='聊天消息表';
```

### 4.2 message_audit_log - 消息审核日志表
```sql
CREATE TABLE `message_audit_log` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `msg_id` BIGINT UNSIGNED NOT NULL COMMENT '消息ID',
  `audit_type` ENUM('auto', 'manual') DEFAULT 'auto' COMMENT '审核类型',
  `audit_result` ENUM('passed', 'blocked') NOT NULL COMMENT '审核结果',
  `risk_keywords` JSON DEFAULT NULL COMMENT '风险关键词',
  `audit_score` DECIMAL(5,2) DEFAULT NULL COMMENT '风险评分',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_msg` (`msg_id`),
  KEY `idx_result` (`audit_result`, `created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息审核日志表';
```

## 5. 支付相关表

### 5.1 orders - 订单表
```sql
CREATE TABLE `orders` (
  `order_id` VARCHAR(64) NOT NULL COMMENT '订单ID（商户订单号）',
  `payer_uid` BIGINT UNSIGNED NOT NULL COMMENT '支付者ID',
  `match_id` BIGINT UNSIGNED DEFAULT NULL COMMENT '匹配ID（解锁订单）',
  `activity_id` BIGINT UNSIGNED DEFAULT NULL COMMENT '活动ID（活动订单）',
  `order_type` ENUM('unlock_single', 'unlock_monthly', 'unlock_yearly', 'activity') NOT NULL COMMENT '订单类型',
  `amount` DECIMAL(10,2) NOT NULL COMMENT '订单金额（元）',
  `platform_fee` DECIMAL(10,2) DEFAULT NULL COMMENT '平台抽成（30%）',
  `status` ENUM('pending', 'paid', 'failed', 'refunded', 'cancelled') DEFAULT 'pending' COMMENT '订单状态',
  `payment_method` VARCHAR(20) DEFAULT NULL COMMENT '支付方式',
  `transaction_id` VARCHAR(64) DEFAULT NULL COMMENT '微信交易号',
  `paid_at` DATETIME DEFAULT NULL COMMENT '支付时间',
  `expires_at` DATETIME DEFAULT NULL COMMENT '订单过期时间',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`order_id`),
  KEY `idx_payer` (`payer_uid`, `status`),
  KEY `idx_match` (`match_id`),
  KEY `idx_status` (`status`, `created_at`),
  KEY `idx_transaction` (`transaction_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

### 5.2 contact_unlock - 联系方式解锁表
```sql
CREATE TABLE `contact_unlock` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `match_id` BIGINT UNSIGNED NOT NULL COMMENT '匹配ID',
  `order_id` VARCHAR(64) NOT NULL COMMENT '订单ID',
  `payer_uid` BIGINT UNSIGNED NOT NULL COMMENT '支付者ID',
  `target_uid` BIGINT UNSIGNED NOT NULL COMMENT '目标用户ID',
  `wechat_a` VARCHAR(50) DEFAULT NULL COMMENT '用户A的微信号（加密）',
  `wechat_b` VARCHAR(50) DEFAULT NULL COMMENT '用户B的微信号（加密）',
  `a_agree` TINYINT DEFAULT 0 COMMENT '用户A是否同意',
  `b_agree` TINYINT DEFAULT 0 COMMENT '用户B是否同意',
  `exposed_at` DATETIME DEFAULT NULL COMMENT '联系方式暴露时间',
  `status` ENUM('pending', 'accepted', 'rejected', 'expired') DEFAULT 'pending' COMMENT '状态',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_match_order` (`match_id`, `order_id`),
  KEY `idx_status` (`status`),
  KEY `idx_payer` (`payer_uid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='联系方式解锁表';
```

### 5.3 payment_log - 支付日志表
```sql
CREATE TABLE `payment_log` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `order_id` VARCHAR(64) NOT NULL COMMENT '订单ID',
  `log_type` ENUM('request', 'callback', 'refund') NOT NULL COMMENT '日志类型',
  `log_data` JSON NOT NULL COMMENT '日志数据',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_order` (`order_id`, `created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='支付日志表';
```

## 6. 活动相关表

### 6.1 activities - 活动表
```sql
CREATE TABLE `activities` (
  `activity_id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(100) NOT NULL COMMENT '活动标题',
  `description` TEXT COMMENT '活动描述',
  `type` ENUM('weekly', 'monthly', 'quarterly') NOT NULL COMMENT '活动类型',
  `start_time` DATETIME NOT NULL COMMENT '开始时间',
  `end_time` DATETIME DEFAULT NULL COMMENT '结束时间',
  `location` VARCHAR(255) DEFAULT NULL COMMENT '活动地点',
  `max_count` INT DEFAULT 15 COMMENT '最大人数',
  `min_count` INT DEFAULT 10 COMMENT '最小人数',
  `fee` DECIMAL(10,2) DEFAULT 0 COMMENT '活动费用（非会员）',
  `member_free` TINYINT DEFAULT 1 COMMENT '会员是否免费',
  `status` ENUM('draft', 'open', 'full', 'ongoing', 'ended', 'cancelled') DEFAULT 'draft' COMMENT '活动状态',
  `checkin_code` VARCHAR(20) DEFAULT NULL COMMENT '签到码',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`activity_id`),
  KEY `idx_type_status` (`type`, `status`),
  KEY `idx_start_time` (`start_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='活动表';
```

### 6.2 activity_enrollments - 活动报名表
```sql
CREATE TABLE `activity_enrollments` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `activity_id` BIGINT UNSIGNED NOT NULL COMMENT '活动ID',
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `order_id` VARCHAR(64) DEFAULT NULL COMMENT '订单ID（如果需要付费）',
  `checkin_status` ENUM('not_checked', 'checked') DEFAULT 'not_checked' COMMENT '签到状态',
  `checkin_at` DATETIME DEFAULT NULL COMMENT '签到时间',
  `feedback_submitted` TINYINT DEFAULT 0 COMMENT '是否已提交反馈',
  `status` ENUM('enrolled', 'cancelled', 'attended', 'absent') DEFAULT 'enrolled' COMMENT '报名状态',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_activity_user` (`activity_id`, `uid`),
  KEY `idx_uid` (`uid`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='活动报名表';
```

### 6.3 activity_feedback - 活动反馈表
```sql
CREATE TABLE `activity_feedback` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `activity_id` BIGINT UNSIGNED NOT NULL COMMENT '活动ID',
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `rating` TINYINT NOT NULL COMMENT '评分（1-5）',
  `comment` TEXT COMMENT '反馈内容',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_activity_user` (`activity_id`, `uid`),
  KEY `idx_rating` (`rating`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='活动反馈表';
```

## 7. 风控相关表

### 7.1 user_reports - 用户举报表
```sql
CREATE TABLE `user_reports` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `reporter_uid` BIGINT UNSIGNED NOT NULL COMMENT '举报者ID',
  `reported_uid` BIGINT UNSIGNED NOT NULL COMMENT '被举报者ID',
  `match_id` BIGINT UNSIGNED DEFAULT NULL COMMENT '相关匹配ID',
  `report_type` ENUM('spam', 'harassment', 'fraud', 'inappropriate', 'other') NOT NULL COMMENT '举报类型',
  `reason` TEXT NOT NULL COMMENT '举报原因',
  `evidence` JSON DEFAULT NULL COMMENT '证据（图片URL等）',
  `status` ENUM('pending', 'processing', 'resolved', 'rejected') DEFAULT 'pending' COMMENT '处理状态',
  `admin_note` TEXT DEFAULT NULL COMMENT '管理员备注',
  `resolved_at` DATETIME DEFAULT NULL COMMENT '处理时间',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_reported` (`reported_uid`, `status`),
  KEY `idx_reporter` (`reporter_uid`),
  KEY `idx_status` (`status`, `created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户举报表';
```

### 7.2 user_blocks - 用户拉黑表
```sql
CREATE TABLE `user_blocks` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `blocked_uid` BIGINT UNSIGNED NOT NULL COMMENT '被拉黑用户ID',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_blocked` (`uid`, `blocked_uid`),
  KEY `idx_uid` (`uid`),
  KEY `idx_blocked` (`blocked_uid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户拉黑表';
```

### 7.3 user_risk_log - 用户风险日志表
```sql
CREATE TABLE `user_risk_log` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `uid` BIGINT UNSIGNED NOT NULL COMMENT '用户ID',
  `risk_type` VARCHAR(50) NOT NULL COMMENT '风险类型',
  `risk_score` INT DEFAULT 0 COMMENT '风险分数',
  `description` TEXT COMMENT '风险描述',
  `action_taken` VARCHAR(100) DEFAULT NULL COMMENT '采取的行动',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_uid` (`uid`, `created_at`),
  KEY `idx_risk` (`risk_type`, `risk_score`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户风险日志表';
```

## 8. 系统配置表

### 8.1 system_config - 系统配置表
```sql
CREATE TABLE `system_config` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `config_key` VARCHAR(100) NOT NULL COMMENT '配置键',
  `config_value` TEXT NOT NULL COMMENT '配置值（JSON）',
  `description` VARCHAR(255) DEFAULT NULL COMMENT '配置描述',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_key` (`config_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';
```

## 9. 索引优化建议

1. **匹配查询优化**：`match_index` 表使用向量数据库（如 Milvus）进行 ANN 检索
2. **聊天记录优化**：`messages` 表按 `match_id` 分表，历史数据归档
3. **订单查询优化**：`orders` 表按时间分表，冷热数据分离
4. **用户表优化**：`users` 表按 `uid` 范围分库分表

## 10. 数据加密说明

- **敏感字段加密**：`users.phone`, `user_identity.doc_hash_enc`, `contact_unlock.wechat_a/b` 使用 AES-256 加密
- **向量数据**：`match_index.feature_vec` 等 BLOB 字段存储二进制向量数据
- **JSON 字段**：使用 MySQL 5.7+ 的 JSON 类型，支持索引和查询优化
