# 批量导入用户指南

本工具支持批量创建用户数据并上传照片，无需逐个登录。

## 快速开始

### 方法1：仅创建用户数据（不上传照片）

```bash
npm run init:users
```

这会创建20个测试用户的基础数据和问卷数据，保存在 `data/` 目录。

### 方法2：批量导入用户+上传照片（推荐）

```bash
# 指定照片目录
npm run batch:import -- --photos-dir "D:\TEST"

# 或直接运行
node scripts/batch-import-users.js --photos-dir "D:\TEST"
```

这会：
1. 创建20个用户数据
2. 自动从指定目录查找照片
3. 为每个用户上传照片
4. 获取AI评分

## 详细使用方法

### 基本用法

```bash
# 使用默认设置（自动查找照片）
node scripts/batch-import-users.js

# 指定照片目录
node scripts/batch-import-users.js --photos-dir "D:\TEST"

# 指定API地址
node scripts/batch-import-users.js --api-url "http://localhost:3001"

# 不上传照片，只创建用户数据
node scripts/batch-import-users.js --no-photos
```

### 命令行参数

- `--photos-dir <目录>` - 指定照片目录
- `--no-photos` - 不上传照片
- `--api-url <URL>` - 指定API地址（默认: http://localhost:3000）

### 环境变量

```bash
# 设置API地址
export API_BASE_URL="http://localhost:3001"
node scripts/batch-import-users.js
```

## 工作流程

1. **检查服务器** - 确保后端服务器正在运行
2. **初始化用户数据** - 创建20个测试用户（10男10女）
3. **查找照片文件** - 从指定目录或常见位置查找照片
4. **批量上传照片** - 为每个用户上传照片并获取AI评分
5. **生成报告** - 保存导入结果

## 照片要求

- 格式：jpg, jpeg, png, gif, webp
- 数量：建议至少10-20张（对应用户数量）
- 质量：清晰的人脸照片效果更好

## 输出文件

导入完成后会生成：

- `data/users.json` - 用户基础信息
- `data/questionnaire.json` - 问卷数据
- `data/photos.json` - 照片数据
- `data/upload-results.json` - 上传结果（包含照片URL和AI评分）

## 示例输出

```
========================================
批量导入用户工具
========================================

检查服务器状态: http://localhost:3000...
✓ 服务器运行正常

步骤1: 初始化用户数据...
✓ 创建用户 1: 小明 (男生)
✓ 创建用户 2: 张同学 (男生)
...
✓ 用户数据已生成

步骤2: 查找照片文件...
从目录找到 15 张照片: D:\TEST
✓ 找到 15 张照片

步骤3: 批量上传照片...
上传间隔: 1000ms

[1/15] 上传照片: channels4_profile.jpg
  用户: 小明 (男生)
  ✓ 上传成功
  照片URL: http://localhost:3000/uploads/xxx.jpg
  颜值评分: 6.2
  AI评分: {"气质匹配度":6.2,"风格契合度":6.9,"整体协调度":5.1}
  检测到人脸: 是

...

========================================
导入完成！
========================================

用户数据: 20 个
问卷数据: 20 个
照片上传: 15 成功, 0 失败
```

## 注意事项

1. **服务器必须运行** - 确保后端服务器已启动
2. **照片数量** - 如果照片少于用户数，只会上传已有照片
3. **上传间隔** - 默认1秒间隔，避免API限流
4. **网络稳定** - 确保网络连接稳定，上传过程中不要中断

## 与手动登录的区别

### 批量导入（推荐用于测试/初始数据）
- ✅ 快速创建大量用户
- ✅ 自动上传照片和获取AI评分
- ✅ 适合初始数据填充
- ❌ OpenID是模拟的（test_openid_xxx）
- ❌ 没有真实的微信登录信息

### 手动登录（真实用户）
- ✅ 真实的微信OpenID
- ✅ 完整的用户认证流程
- ✅ 适合生产环境
- ❌ 需要逐个操作
- ❌ 耗时较长

## 推荐流程

1. **开发测试阶段**：使用批量导入创建测试数据
2. **初始用户填充**：批量导入10-20个种子用户
3. **真实用户**：通过小程序正常注册

## 故障排除

### 服务器未运行
```
✗ 服务器未运行！
请确保服务器已启动: npm start
```
解决：启动服务器 `npm start`

### 未找到照片
```
⚠ 未找到照片文件，将跳过照片上传
```
解决：使用 `--photos-dir` 参数指定照片目录

### 上传失败
检查：
1. 服务器日志查看错误信息
2. 网络连接是否正常
3. Face++ API Secret是否配置
4. 照片文件是否损坏

## 下一步

导入完成后，你可以：

1. **查看用户列表**：
   ```bash
   curl http://localhost:3000/api/admin/users
   ```

2. **导入到数据库**（如果有）：
   - 将JSON数据转换为SQL
   - 导入到MySQL数据库

3. **测试匹配功能**：
   - 使用匹配服务计算用户之间的匹配分数
   - 测试推荐算法

