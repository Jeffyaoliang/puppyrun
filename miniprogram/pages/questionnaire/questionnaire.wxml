<!--pages/questionnaire/questionnaire.wxml-->
<view class="questionnaire-container">
  <!-- 进度条 -->
  <view class="progress-bar">
    <view class="progress-fill" style="width: {{(currentStep / totalSteps) * 100}}%"></view>
  </view>
  <view class="progress-text">步骤 {{currentStep}} / {{totalSteps}}</view>

  <!-- 步骤1: 基础信息 -->
  <view wx:if="{{currentStep === 1}}" class="step-container">
    <view class="step-title">基础信息</view>
    
    <view class="form-item">
      <text class="label">年龄</text>
      <picker mode="selector" range="{{[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]}}" value="{{basicInfo.age > 0 ? basicInfo.age - 18 : 0}}" bindchange="onAgeChange">
        <view class="picker">{{basicInfo.age || '请选择年龄'}}</view>
      </picker>
    </view>

    <view class="form-item" wx:if="{{userRole === 'male_student'}}">
      <text class="label">学历</text>
      <picker mode="selector" range="{{['本科', '硕士', '博士']}}" value="{{['本科', '硕士', '博士'].indexOf(basicInfo.education)}}" bindchange="onEducationChange">
        <view class="picker">{{basicInfo.education || '请选择学历'}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">所在城市</text>
      <input class="input" placeholder="请输入城市" value="{{basicInfo.city}}" bindinput="onCityChange" />
    </view>
  </view>

  <!-- 步骤2: 兴趣偏好 -->
  <view wx:if="{{currentStep === 2}}" class="step-container">
    <view class="step-title">兴趣偏好（可多选）</view>
    
    <view class="options-grid">
      <view 
        wx:for="{{interestOptions}}" 
        wx:key="*this"
        wx:for-item="interest"
        wx:for-index="idx"
        class="option-item {{interests.indexOf(interest) > -1 ? 'selected' : ''}}"
        bindtap="toggleInterest"
        data-interest="{{interest}}"
      >
        {{interest}}
      </view>
    </view>
  </view>

  <!-- 步骤3: 社交需求 -->
  <view wx:if="{{currentStep === 3}}" class="step-container">
    <view class="step-title">社交需求（可多选）</view>
    
    <view class="options-list">
      <view 
        wx:for="{{socialNeedOptions}}" 
        wx:key="index"
        class="option-item {{socialNeeds.indexOf(item) > -1 ? 'selected' : ''}}"
        bindtap="toggleSocialNeed"
        data-need="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>

  <!-- 步骤4: 价值观 -->
  <view wx:if="{{currentStep === 4}}" class="step-container">
    <view class="step-title">价值观倾向</view>
    
    <view class="form-item">
      <text class="label">消费观</text>
      <picker mode="selector" range="{{consumptionOptions}}" value="{{values.consumption ? consumptionOptions.indexOf(values.consumption) : 0}}" bindchange="onConsumptionChange">
        <view class="picker">{{values.consumption || '请选择消费观'}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">社交边界</text>
      <picker mode="selector" range="{{boundaryOptions}}" value="{{values.boundary ? boundaryOptions.indexOf(values.boundary) : 0}}" bindchange="onBoundaryChange">
        <view class="picker">{{values.boundary || '请选择社交边界'}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">沟通方式</text>
      <picker mode="selector" range="{{communicationOptions}}" value="{{values.communication ? communicationOptions.indexOf(values.communication) : 0}}" bindchange="onCommunicationChange">
        <view class="picker">{{values.communication || '请选择沟通方式'}}</view>
      </picker>
    </view>
  </view>

  <!-- 步骤5: 外貌偏好 + 照片 -->
  <view wx:if="{{currentStep === 5}}" class="step-container">
    <view class="step-title">外貌偏好</view>
    
    <view class="form-item">
      <text class="label">风格偏好</text>
      <picker mode="selector" range="{{styleOptions}}" value="{{appearancePref.style ? styleOptions.indexOf(appearancePref.style) : 0}}" bindchange="onStyleChange">
        <view class="picker">{{appearancePref.style || '请选择风格偏好'}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">接受度</text>
      <picker mode="selector" range="{{acceptanceOptions}}" value="{{appearancePref.acceptance ? acceptanceOptions.indexOf(appearancePref.acceptance) : 0}}" bindchange="onAcceptanceChange">
        <view class="picker">{{appearancePref.acceptance || '请选择接受度'}}</view>
      </picker>
    </view>

    <view class="photos-section">
      <text class="label">上传生活照（至少1张）</text>
      <view class="photos-grid">
        <view 
          wx:for="{{photos}}" 
          wx:key="index"
          class="photo-item"
        >
          <image src="{{item}}" mode="aspectFill" class="photo"></image>
          <view class="delete-btn" bindtap="deletePhoto" data-index="{{index}}">×</view>
        </view>
        <view class="photo-item add-photo" bindtap="uploadPhoto" wx:if="{{photos.length < 6}}">
          <text>+</text>
          <text class="add-text">添加照片</text>
        </view>
      </view>
      <text class="hint">请上传清晰的生活照，需露脸且无过度美颜</text>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button wx:if="{{currentStep > 1}}" class="prev-btn" bindtap="prevStep">上一步</button>
    <button class="next-btn" bindtap="nextStep">
      {{currentStep === totalSteps ? '提交' : '下一步'}}
    </button>
  </view>
</view>
