<!--pages/questionnaire/questionnaire.wxml-->
<view class="questionnaire-container">
  <!-- 进度条 -->
  <view class="progress-bar">
    <view class="progress-fill" style="width: {{(currentStep / totalSteps) * 100}}%"></view>
  </view>
  <view class="progress-text">步骤 {{currentStep}} / {{totalSteps}}</view>

  <!-- 步骤1: 基础信息 -->
  <view wx:if="{{currentStep === 1}}" class="step-container">
    <view class="step-title">基础信息</view>
    
    <view class="form-item">
      <text class="label">年龄</text>
      <picker mode="selector" range="{{ageOptions}}" value="{{basicInfo.age > 0 ? ageOptions.indexOf(basicInfo.age) : 0}}" bindchange="onAgeChange">
        <view class="picker">{{basicInfo.age || '请选择年龄'}}</view>
      </picker>
    </view>

    <view class="form-item" wx:if="{{userRole === 'male_student'}}">
      <text class="label">学历</text>
      <picker mode="selector" range="{{['本科', '硕士', '博士']}}" value="{{['本科', '硕士', '博士'].indexOf(basicInfo.education)}}" bindchange="onEducationChange">
        <view class="picker">{{basicInfo.education || '请选择学历'}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">所在城市</text>
      <input class="input" placeholder="请输入城市" value="{{basicInfo.city}}" bindinput="onCityChange" />
    </view>

    <view class="form-item">
      <text class="label">身高 (cm)</text>
      <input class="input" type="number" placeholder="请输入身高" value="{{basicInfo.height}}" bindinput="onHeightChange" />
    </view>

    <view class="form-item">
      <text class="label">体重 (kg)</text>
      <input class="input" type="number" placeholder="请输入体重" value="{{basicInfo.weight}}" bindinput="onWeightChange" />
    </view>
  </view>

  <!-- 步骤2: 兴趣偏好 -->
  <view wx:if="{{currentStep === 2}}" class="step-container">
    <view class="step-title">兴趣偏好（可多选）</view>
    
    <view class="options-grid">
      <view 
        wx:for="{{interestOptions}}" 
        wx:key="*this"
        wx:for-item="interest"
        wx:for-index="idx"
        class="option-item {{interests.indexOf(interest) > -1 ? 'selected' : ''}} {{userRole === 'female' && interests.indexOf(interest) > -1 ? 'female-selected' : ''}} {{userRole === 'male_student' && interests.indexOf(interest) > -1 ? 'male-selected' : ''}}"
        bindtap="toggleInterest"
        data-interest="{{interest}}"
      >
        {{interest}}
      </view>
    </view>
  </view>

  <!-- 步骤3: 恋爱观倾向（原步骤4） -->
  <view wx:if="{{currentStep === 3}}" class="step-container">
    <view class="step-title">恋爱观倾向</view>
    
    <view class="form-item">
      <text class="label">{{consumptionLabel}}</text>
      <picker mode="selector" range="{{consumptionOptions}}" value="{{values.consumption ? consumptionOptions.indexOf(values.consumption) : 0}}" bindchange="onConsumptionChange">
        <view class="picker">{{values.consumption || '请选择' + consumptionLabel}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">{{boundaryLabel}}</text>
      <picker mode="selector" range="{{boundaryOptions}}" value="{{values.boundary ? boundaryOptions.indexOf(values.boundary) : 0}}" bindchange="onBoundaryChange">
        <view class="picker">{{values.boundary || '请选择' + boundaryLabel}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">沟通方式</text>
      <picker mode="selector" range="{{communicationOptions}}" value="{{values.communication ? communicationOptions.indexOf(values.communication) : 0}}" bindchange="onCommunicationChange">
        <view class="picker">{{values.communication || '请选择沟通方式'}}</view>
      </picker>
    </view>
  </view>

  <!-- 步骤4: 外貌偏好（原步骤5） -->
  <view wx:if="{{currentStep === 4}}" class="step-container">
    <view class="step-title">外貌偏好</view>
    
    <view class="form-item">
      <text class="label">{{acceptanceLabel}}</text>
      <picker mode="selector" range="{{acceptanceOptions}}" value="{{appearancePref.acceptance ? acceptanceOptions.indexOf(appearancePref.acceptance) : 0}}" bindchange="onAcceptanceChange">
        <view class="picker">{{appearancePref.acceptance || '请选择' + acceptanceLabel}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">身高要求</text>
      <picker mode="selector" range="{{heightRequirementOptions}}" value="{{appearancePref.heightRequirement ? heightRequirementOptions.indexOf(appearancePref.heightRequirement) : 0}}" bindchange="onHeightRequirementChange">
        <view class="picker">{{appearancePref.heightRequirement || '请选择身高要求'}}</view>
      </picker>
    </view>
  </view>

  <!-- 步骤5: 上传生活照（原步骤6） -->
  <view wx:if="{{currentStep === 5}}" class="step-container">
    <view class="step-title">上传生活照</view>
    
    <view class="photos-section">
      <text class="label">上传生活照（至少1张）</text>
      <view class="photos-grid">
        <view 
          wx:for="{{photos}}" 
          wx:key="index"
          class="photo-item"
        >
          <image src="{{item}}" mode="aspectFill" class="photo"></image>
          <view class="delete-btn" bindtap="deletePhoto" data-index="{{index}}">×</view>
        </view>
        <view class="photo-item add-photo" bindtap="uploadPhoto" wx:if="{{photos.length < 6}}">
          <text>+</text>
          <text class="add-text">添加照片</text>
        </view>
      </view>
      <text class="hint">请上传清晰的生活照，需露脸且无过度美颜</text>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button wx:if="{{currentStep > 1}}" class="prev-btn" bindtap="prevStep">上一步</button>
    <button class="next-btn" bindtap="nextStep">
      {{currentStep === totalSteps ? '提交' : '下一步'}}
    </button>
  </view>
</view>
